
NATIVE_ENABLED = true
BYTE_ENABLED = true
OCAMLOPTFLAGS = -S -inline 100
USE_OCAMLFIND = true

.SUBDIRS: ocaml-sqlexpr

OCAMLCFLAGS += -g -annot
OCAMLFINDFLAGS += -syntax camlp4o
OCAMLINCLUDES += ocaml-sqlexpr

OCAMLPACKS[] =
    lwt
    lwt.unix
    lwt.syntax
    estring
    extlib
    unix
    str
    sqlite3
    camlp4.macro

OBJECTS[] =
    extSet
    mq_types
    mq_stomp
    mq_server
    ocaml-sqlexpr/sqlexpr_sqlite
    mq_sqlite_persistence
    ternary
    ocamlmq

section
    OCAMLFINDFLAGS += -ppopt ocaml-sqlexpr/pa_sql.cmo
    .SCANNER: scan-ocaml-%.ml: %.ml ocaml-sqlexpr/pa_sql.cmo
    $(addsuffixes .cmi .cmx .cmo .o, mq_sqlite_persistence):

OCamlProgram(ocamlmq, $(OBJECTS))

.DEFAULT: ocamlmq$(EXE)

.PHONY: clean

clean:
	rm -f $(filter-proper-targets $(ls R, .)) *.s
