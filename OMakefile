
NATIVE_ENABLED = true
OCAMLOPTFLAGS = -S -inline 100
USE_OCAMLFIND = true

OCAMLFLAGS += -syntax camlp4o
OCAMLDEPFLAGS += -syntax camlp4o

OCAMLPACKS[] =
    lwt
    lwt.syntax
    extlib
    unix
    str
    pgocaml
    pgocaml.syntax
    camlp4.macro

OBJECTS[] =
    extSet
    mq_server

mq_schema.ml: schema.sql generate_prepared_statements.rb
        ruby generate_prepared_statements.rb create_db $< > $@

.SCANNER: scan-ocaml-mq_server.ml: mq_server.ml mq_schema.ml

OCamlProgram(mq_server, $(OBJECTS))

.DEFAULT: mq_server$(EXE)

.PHONY: clean

clean:
	rm -f $(filter-proper-targets $(ls R, .)) *.s
